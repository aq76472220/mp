var modules=["api/custom","libs/tools","text!../views/custom.html","css!../../static/assets/css/custom.css"];define(modules,function(e,t,s){return{name:"custom",template:s,data:function(){return{dialogFormVisible:!1,formLabelWidth:"100px",size:0,total:0,tableCustomer:[],form:{name:"",region:"",page:1},status:0,error:"",model:{phone:"",password:"",nickname:"",validateCode:""},rules:{phone:[{required:!0,message:"请输入客户手机号",trigger:"blur"},{min:11,max:11,message:"长度为 11 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",trigger:"blur"},{min:6,max:15,message:"长度在 6 到 15 个字符",trigger:"blur"}],validateCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]},types:[]}},created:function(){var e=this;this.list().then(function(t){var s=t.data;e.types=s.types,e.total=s.users.total,e.size=s.users.per_page,e.tableCustomer=s.users.data})},watch:{"form.page":function(){this.getInfo()},status:function(e){e<0&&(this.error=-1==e?"该用户已是其他代理客户":"该用户已添加")}},methods:{list:function(){var t=this;return new Promise(function(s){e.index(t.form).then(function(e){s(e.data)}).catch(function(e){reject(e)})})},save:function(){var t=this;return new Promise(function(s){e.save(t.model).then(function(e){s(e.data)})})},getInfo:function(){var e=this;this.list().then(function(t){var s=t.data;e.total=s.users.total,e.tableCustomer=s.users.data})},pageChange:function(e){this.form.page=e},search:function(){this.form.page=1,this.getInfo()},checkPhone:function(){if(this.status=0,this.error="",!(""==this.model.phone||this.model.phone.length<11||this.model.phone.length>11)){if(!t.isPhone(this.model.phone))return void(this.error="请输入正确的手机号码");var s=this;(function(t){return new Promise(function(s){e.check_phone(t).then(function(e){s(e.data)})})})(this.model.phone).then(function(e){s.status=e.data.status})}},sendCode:function(){var t=this;(function(t){return new Promise(function(s,n){e.send_code(t).then(function(e){s(e.data)}).catch(function(e){n(e)})})})(this.model.phone).then(function(e){t.$message.success("发送成功")}).catch(function(e){t.$message.error(e)})},confirm:function(){var e=this;this.$refs.addForm.validate(function(s){if(s){if(!t.isPhone(e.model.phone))return void(e.error="请输入正确的手机号码");e.save().then(function(t){e.$message.success("开通成功"),e.$refs.addForm.resetFields(),e.dialogFormVisible=!1,e.getInfo()}).catch(function(t){e.$message.error(t)})}})},empty:function(){this.form.name="",this.form.region=""},applt_view:function(e){this.$router.push({name:"applet",query:{user_id:e}})}}}});